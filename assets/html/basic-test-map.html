<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Fullscreen Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <style>
    #map {
      height: 500px;
      width: 500px;
    }
  </style>
</head>


<body>
    
    <div id="map"></div>

</body>

<script type="text/javascript">
    
    // var map = L.map('map').setView([51.62, -8.89], 13);

    // L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    //     maxZoom: 19,
    //     attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    // }).addTo(map);


    // Import datasets and plot
    // async function addGeoJson(filepath ) {
    //     const response = await fetch(filepath);
    //     const data = await response.json();

    //     // initialise layer and add it to the global var
    //     const layer = L.geoJson(data, {
    //         onEachFeature: onEachFeature
    //     }).addTo(map);

    //     return layer;
    // }
    async function addGeoJson(filepath) {
        const response = await fetch(filepath);
        const data = await response.json();

        const layersByAuthority = {};

        L.geoJson(data, {
            onEachFeature: function (feature, layer) {
                // create popup cards
                layer.bindPopup(
                    feature.properties["Park name"] +
                    " in " + "<b>" +
                    feature.properties["Local Authority Area"] +
                    "</b>" +
                    "</br>" +
                    "Here is some text." +
                    "</br>" +
                    "Score A: " +
                    feature.properties["Score 1"] +
                    "</br>" +
                    "Score B: " +
                    feature.properties["Score 2"] +
                    "</br>" +
                    "Does this area have X feature? " +
                    feature.properties["Other measure"] +
                    "</br>" +
                    "Guideline for this location: " +
                    feature.properties["Guideline"]
                );
                // group by local authority area
                const authority = feature.properties["Local Authority Area"];
                if (!layersByAuthority[authority]) {
                    layersByAuthority[authority] = L.layerGroup();
                }
                layersByAuthority[authority].addLayer(layer);
            }
        });

        return layersByAuthority;
    }

    async function setupMap() {
        const layersByAuthority = await addGeoJson("../../data/data-processing/example-parks.geojson");

        // Prepare the overlay layers for the control
        const overlayMaps = {};
        for (const authority in layersByAuthority) {
            overlayMaps[authority] = layersByAuthority[authority];
        }

        // Add the layer control to the map
        L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);
        L.control.groupedLayers(null, overlayMaps, {
            exclusiveGroups: Object.keys(layersByAuthority),
            groupCheckboxes: true
        }).addTo(map);
    }

    var map = L.map('map').setView([51.62, -8.89], 10);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    

    setupMap();

    

    // let example_geojson_layer;
    // example_geojson_layer = addGeoJson("../../data/data-processing/example-parks.geojson")

    // for the geojson created, check unique values of areas
    // const uniqueStatuses = [...new Set(example_geojson_layer.features.map(f => f.properties["Local Authority Area"]))];

    // marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
    // circle.bindPopup("I am a circle.");
    // polygon.bindPopup("I am a polygon.");

    
    // function onMapClick(e) {
    //     alert("You clicked the map at " + e.latlng);
    // }

    // var popup = L.popup();

    // function onMapClick(e) {
    //     popup
    //         .setLatLng(e.latlng)
    //         .setContent("You clicked the map at " + e.latlng.toString())
    //         .openOn(map);
    // }

    // map.on('click', onMapClick);

    // https://stackoverflow.com/questions/37023790/leaflet-create-layers-from-geojson-properties

</script>

</html>
